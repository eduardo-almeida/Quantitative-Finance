1. Teoria moderna de portfólio (MPT); fronteiras eficientes
Neste capítulo, aprenderemos como usar o aprendizado de máquina para seleção de portfólio com a moderna teoria de portfólio, ou MPT.

2. Fronteira eficiente
Uma carteira é um grupo de ativos, como ações e títulos. A teoria moderna de portfólio tenta encontrar carteiras de investimento ideais quantificando retornos e riscos. Os retornos são a variação percentual no preço dos ativos. O risco é medido por meio da volatilidade, usando o desvio padrão. Com o MPT, terminamos com um gráfico de volatilidade vs retornos, mostrando a "fronteira eficiente". O limite superior esquerdo do gráfico é a "fronteira eficiente", que mostra os retornos máximos dado um certo risco.

3. Junção de dados
Usaremos 3 títulos, também conhecidos como ações, aqui: AMD, CHK e QQQ. O método concat () do pandas é usado para juntar os DataFrames fornecendo uma lista de DataFrames como o primeiro argumento. Definimos axis = 1 para empilhar DataFrames horizontalmente. As linhas com valores ausentes são eliminadas usando dropna () para que cada data tenha todos os preços das ações.

4. Calculando retornos
Primeiro, devemos decidir sobre um prazo para rebalancear nossas carteiras, que é quando venderemos e compraremos ações que correspondam à nossa carteira desejada. Aqui, usaremos o cronograma mensal para que tenhamos dados suficientes, mas um cronograma anual pode ser bom para fins fiscais nos EUA. Calcularemos os retornos diários usando pct_change em full_df e armazenaremos em return_daily; isso será usado para estimar a volatilidade. Em seguida, obtemos um DataFrame chamado Monthly_df que contém dados do primeiro dia de cada mês. Fazemos isso reamostrando full_df com BMS, que significa "business month start". Usamos first () para obter o primeiro dia de cada mês. Finalmente, obtemos os retornos mensais usando pct_change em mensal_df.

5. Covariâncias
A seguir, trabalharemos no sentido de calcular o risco, medido pela volatilidade. Para portfólios, isso é complicado e envolve matemática de matriz. Não entraremos em detalhes, mas devemos calcular as covariâncias de nossas ações para calcular a volatilidade do portfólio em breve. Para isso, percorremos cada mês e calculamos os retornos diários. Estamos usando o mascaramento com o Return_daily DataFrame para obter valores para o mês e o ano que estão atualmente no loop. Em seguida, usamos o método cov () do pandas para calcular as covariâncias.

6. Gerando pesos de portfólio
Em seguida, geramos carteiras gerando primeiro muitos pesos de carteira para cada ação. Examinamos cada data em nosso conjunto de dados usando as chaves de dicionário das covariâncias. Salvamos a covariância da data atual para uso em cálculos de volatilidade. Em seguida, passamos por 5000 iterações e usamos o random-dot-random () de numpy para gerar 3 números para pesos de ativos. Normalizamos esses pesos para que sejam somados, dividindo por sua soma.

7. Calculando retornos e volatilidade
Vamos pegar o código do slide anterior e adicioná-lo. Usamos os pesos para calcular os retornos tomando o produto escalar com np-dot = dot (). O cálculo da volatilidade é mais complexo e envolve as covariâncias e pesos, com alguns produtos escalares e uma raiz quadrada. Não se preocupe com a matemática por enquanto, e apenas use o código fornecido para calcular a volatilidade. Finalmente, estamos usando o método setdefault () do Python para dicionários para criar novas entradas de dicionário com a data como a chave e uma lista vazia como o valor. Para cada portfólio gerado aleatoriamente, acrescentamos os retornos, a volatilidade e os pesos aos respectivos dicionários. Agora temos uma amostra de carteiras que podemos usar para encontrar a "fronteira eficiente".

8. Traçando a fronteira eficiente
Agora traçamos a fronteira eficiente, que mostra os retornos máximos dado um certo risco. Este gráfico pode ser feito para cada data em um gráfico 2D, portanto, usaremos a última data de nosso dicionário de covariâncias. Em seguida, dispersamos a volatilidade contra os retornos com transparência de 50%, usando um valor de 0-ponto-5 para alfa.

9. Calcule carteiras MPT!
Agora é sua vez de calcular as carteiras MPT!